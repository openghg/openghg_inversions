# The template in single_gas_single_sector.toml would be converted to the following
# "ini" files.
#
# Note: the values shown are examples, and they would need to have placeholders in them
# for a real "ini template" output.

[data]

# arguments that apply to all obs/fp data
species = "ch4"
averaging_period = ["4h", "4h"]
start_date = "2019-01-01"
end_date = "2019-02-01"

domain = "europe"
fp_model = "NAME"
met_model = "UKV"
fp_species = "inert"  # TODO: this should be inferred if possible...

obs_store = "obs_paris_2024_07_store"
footprint_store = "shared_store_zarr"
emissions_store = "paris_store_zarr"
bc_store = "shared_store_zarr"

sites = ["TAC", "MHD"]
inlets = ["185m", "10m"]
fp_heights = ["185m", "10m"]


[model]


[model.forward]
type = "forward model"


[model.forward.flux]
type = "flux"

[model.forward.flux.data_args]
source = "edgarv80_wetchartsv131_constant"  # this could be a list; the fluxes would be stacked in that case
source_format = "openghg"

[model.forward.flux.basis]
algorithm = "quadtree"
nbasis = 250
# fix_basis_outer_regions = false

[model.forward.flux.prior]
pdf = "lognormal"
mean = 1.0
stdev = 2.0
reparameterise = true


[model.forward.baseline]
type = "baseline"
use_baseline = true  # "optional" turns into "use_{name}"


[model.forward.baseline.bc]
type = "bc"
use_bc = true

[model.forward.baseline.bc.data_args]
bc_input = "camsv19_daily"  # TODO: why isn't this called "source"?

[model.forward.baseline.bc.basis]
basis_directory = "default"
basis_type = "NESW"

[model.forward.baseline.bc.prior]
pdf = "truncatednormal"
mu = 1.0
sigma = 0.1
lower = 0.0

[model.forward.baseline.bc.setup]
freq = "monthly"


[model.forward.baseline.offset]
type = "offset"
use_offset = false


[model.likelihood]
type = "rhime likelihood"
inputs = ["forward"]  # TODO: should this be "model.forward"? ...no because we'll parse the "model" table like we would the template

[model.likelihood.sigma]  # TODO how do we know to add this?
type = "sigma"

prior = {pdf = "uniform", lower = 0.1, upper = 3.0}
freq = "8D"
per_site = true

# [model.likelihood.min_error]
# min_error = 0.0
# calculate_min_error = "residual"
# by_site = true

[model.likelihood.options]
pollution_events_from_obs = true
no_model_error = false


[sampling]
# sampling options...
nuts_sampler = "numpyro"

nit = 20000
burn = 10000
tune = 20000

nchain = 4


[output]
# output options...
save_trace = true
output_path = "/user/work/ro21302/inversion_outputs"
output_name = "modular_test"

country_file = "/group/chemistry/acrg/PARIS_results_sharing/country_masks/EUROPE_EEZ_PARIS_gapfilled.nc"
